<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=400">
    <title>LMS QA Validator</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-title">
            <svg class="logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 11l3 3L22 4"/>
                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
            </svg>
            <h1>LMS QA Validator</h1>
        </div>
        <div id="status-indicator" class="status-indicator">
            <span class="status-dot"></span>
            <span class="status-text">Ready</span>
        </div>
    </header>

    <!-- Tab URL & Activation Status -->
    <div class="tab-info">
        <span class="tab-label">Page:</span>
        <span id="tab-url" class="tab-url">Loading...</span>
    </div>

    <!-- Activation Gate Panel - Shows when not on LMS or no rules -->
    <section id="activation-gate" class="activation-gate">
        <div class="gate-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4M12 8h.01"/>
            </svg>
        </div>
        <div class="gate-message">
            <p id="gate-reason">Checking page...</p>
        </div>
        <div class="gate-actions">
            <button id="btn-force-activate" class="btn btn-outline">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                </svg>
                Activate Anyway
            </button>
            <button id="btn-import-rules-gate" class="btn btn-primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Import Rules
            </button>
        </div>
    </section>

    <!-- Framework Detection Panel - Shows after detection -->
    <section id="framework-panel" class="framework-panel">
        <div class="framework-header">
            <div class="framework-icon" id="framework-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                    <path d="M22 4L12 14.01l-3-3"/>
                </svg>
            </div>
            <div class="framework-info">
                <span class="framework-label">Detected Framework</span>
                <span id="framework-name" class="framework-name">Scanning...</span>
            </div>
        </div>
        <div id="framework-details" class="framework-details">
            <!-- Will show detected APIs, potential Q&A count, etc -->
        </div>
        <div class="framework-actions">
            <button id="btn-extract-qa" class="btn btn-primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                </svg>
                Extract Q&A
            </button>
            <button id="btn-complete-course" class="btn btn-success">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                    <path d="M22 4L12 14.01l-3-3"/>
                </svg>
                Complete Course
            </button>
            <button id="btn-skip-detection" class="btn btn-outline btn-sm">
                Skip
            </button>
        </div>
    </section>

    <!-- Main Actions - Only show when activated -->
    <div id="main-actions" class="actions-primary">
        <button id="btn-scan" class="btn btn-primary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
            </svg>
            Scan Page
        </button>
        <button id="btn-clear" class="btn btn-secondary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
            </svg>
            Clear
        </button>
    </div>

    <!-- Progress -->
    <div id="progress-container" class="progress-container">
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
        </div>
        <span id="progress-text" class="progress-text">Scanning...</span>
    </div>

    <!-- Operation Feedback Panel - Shows during/after operations -->
    <section id="operation-feedback" class="operation-feedback">
        <div class="operation-header">
            <span class="operation-icon" id="operation-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
            </span>
            <span id="operation-status" class="operation-status">Processing...</span>
        </div>
        <div id="operation-details" class="operation-details">
            <!-- Step-by-step feedback -->
        </div>
        <div id="operation-result" class="operation-result">
            <!-- Success/failure summary -->
        </div>
        <div class="operation-actions">
            <button id="btn-retry-operation" class="btn btn-outline btn-sm">Retry</button>
            <button id="btn-try-alternative" class="btn btn-outline btn-sm">Try Alternative</button>
            <button id="btn-save-config" class="btn btn-primary btn-sm">Save as Quick Action</button>
        </div>
    </section>

    <!-- Validation Warnings -->
    <div id="validation-warnings" class="validation-warnings"></div>

    <!-- Related Windows -->
    <section id="related-windows" class="related-windows">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="3" width="20" height="14" rx="2"/>
                <path d="M8 21h8M12 17v4"/>
            </svg>
            <span>Related Windows</span>
            <button id="btn-refresh-related" class="btn-icon" title="Refresh">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6M1 20v-6h6"/>
                    <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                </svg>
            </button>
        </div>
        <div id="related-list" class="related-list"></div>
    </section>

    <!-- Quick Actions - Shows saved configurations -->
    <section id="quick-actions-saved" class="quick-actions-saved">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
            </svg>
            <span>Quick Actions</span>
            <span id="quick-actions-count" class="badge">0</span>
        </div>
        <div id="quick-actions-list" class="quick-actions-list">
            <!-- Saved successful configurations -->
        </div>
    </section>

    <!-- Search - Only show when results exist -->
    <div id="search-container" class="search-container">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
        </svg>
        <input type="text" id="search-input" class="search-input" placeholder="Filter results...">
        <span id="search-count" class="search-count"></span>
    </div>

    <!-- Results Tabs - Only show when results exist -->
    <nav id="results-tabs" class="results-tabs">
        <button class="tab-btn active" data-tab="qa">
            Q&A <span id="qa-count" class="badge">0</span>
        </button>
        <button class="tab-btn" data-tab="correct">
            Correct <span id="correct-count" class="badge">0</span>
        </button>
        <button class="tab-btn" data-tab="apis">
            APIs <span id="apis-count" class="badge">0</span>
        </button>
        <button class="tab-btn" data-tab="logs">
            Logs <span id="logs-count" class="badge">0</span>
        </button>
    </nav>

    <!-- Tab Panels -->
    <div id="tab-panels" class="tab-panels">
        <div id="qa-panel" class="tab-panel active">
            <div id="qa-list" class="results-list">
                <div class="empty-state">No Q&A found. Try scanning the page.</div>
            </div>
        </div>

        <div id="correct-panel" class="tab-panel">
            <div class="correct-actions">
                <button id="btn-copy-all-correct" class="btn btn-outline btn-sm" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <rect x="9" y="9" width="13" height="13" rx="2"/>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                    Copy All
                </button>
            </div>
            <div id="correct-list" class="results-list">
                <div class="empty-state">No correct answers found.</div>
            </div>
        </div>

        <div id="apis-panel" class="tab-panel">
            <div id="apis-list" class="results-list">
                <div class="empty-state">No SCORM/xAPI detected.</div>
            </div>
        </div>

        <div id="logs-panel" class="tab-panel">
            <div id="logs-list" class="results-list logs-list">
                <div class="empty-state">No logs yet.</div>
            </div>
        </div>
    </div>

    <!-- SCORM Controls - Only show when APIs detected -->
    <section id="scorm-controls" class="scorm-controls">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            <span>SCORM Controls</span>
        </div>
        <div class="control-row">
            <button id="btn-test-api" class="btn btn-outline">Test API</button>
        </div>
        <div class="control-row">
            <select id="completion-status" class="select">
                <option value="completed">Completed</option>
                <option value="passed">Passed</option>
                <option value="failed">Failed</option>
                <option value="incomplete">Incomplete</option>
            </select>
            <input type="number" id="completion-score" class="input" value="100" min="0" max="100">
            <button id="btn-set-completion" class="btn btn-accent">Set</button>
        </div>
    </section>

    <!-- Element Picker Section -->
    <section id="element-picker" class="element-picker">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3h6v6H3zM15 3h6v6h-6zM3 15h6v6H3z"/>
                <path d="M15 15h6v6h-6z"/>
                <circle cx="12" cy="12" r="2"/>
            </svg>
            <span>Manual Selection</span>
        </div>
        <button id="btn-element-selector" class="btn btn-primary full-width" style="margin-bottom: 8px;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3h6v6H3zM15 3h6v6h-6zM3 15h6v6H3z"/>
                <path d="M15 15h6v6h-6z"/>
                <circle cx="12" cy="12" r="2"/>
            </svg>
            Pick Q&A Elements
        </button>
        <button id="btn-auto-select" class="btn btn-success full-width">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                <path d="M22 4L12 14.01l-3-3"/>
            </svg>
            Auto-Select Answers
        </button>
    </section>

    <!-- Saved Rules - Only show if rule exists for current page -->
    <section id="saved-rules" class="saved-rules" style="display: none;">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
            </svg>
            <span>Saved Rule</span>
        </div>
        <div id="rule-info" class="rule-info"></div>
        <div class="rule-actions">
            <button id="btn-apply-rule" class="btn btn-outline btn-sm">Apply Rule</button>
            <button id="btn-delete-rule" class="btn btn-outline btn-sm btn-danger">Delete</button>
        </div>
    </section>

    <!-- Rules Management -->
    <section id="rules-management" class="rules-management">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
            </svg>
            <span>Selector Rules</span>
            <span id="rules-count" class="badge rules-badge">0</span>
        </div>
        <div class="rules-buttons">
            <button id="btn-export-rules" class="btn btn-outline btn-sm">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Export
            </button>
            <button id="btn-import-rules" class="btn btn-outline btn-sm">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Import
            </button>
        </div>
        <input type="file" id="rules-file-input" accept=".json" style="display: none;">
    </section>

    <!-- Export Actions - Only show when results exist -->
    <section id="export-actions" class="export-actions">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            <span>Export Results</span>
        </div>
        <div class="export-buttons">
            <button id="btn-export-json" class="btn btn-outline">JSON</button>
            <button id="btn-export-csv" class="btn btn-outline">CSV</button>
            <button id="btn-export-txt" class="btn btn-outline">TXT</button>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <span class="version">v4.0</span>
        <span class="shortcuts">Ctrl+R: Scan | Ctrl+F: Search | Ctrl+E: Export</span>
    </footer>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script src="popup.js"></script>
</body>
</html>
