<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=400">
    <title>LMS QA Validator</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-title">
            <svg class="logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 11l3 3L22 4"/>
                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
            </svg>
            <h1>LMS QA Validator</h1>
        </div>
        <div id="status-indicator" class="status-indicator">
            <span class="status-dot"></span>
            <span class="status-text">Ready</span>
        </div>
    </header>

    <!-- Tab URL -->
    <div class="tab-info">
        <span class="tab-label">Page:</span>
        <span id="tab-url" class="tab-url">Loading...</span>
    </div>

    <!-- Main Actions -->
    <div class="actions-primary">
        <button id="btn-scan" class="btn btn-primary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
            </svg>
            Scan Page
        </button>
        <button id="btn-clear" class="btn btn-secondary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
            </svg>
            Clear
        </button>
    </div>

    <!-- Progress -->
    <div id="progress-container" class="progress-container">
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
        </div>
        <span id="progress-text" class="progress-text">Scanning...</span>
    </div>

    <!-- Validation Warnings -->
    <div id="validation-warnings" class="validation-warnings"></div>

    <!-- Related Windows -->
    <section id="related-windows" class="related-windows">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="3" width="20" height="14" rx="2"/>
                <path d="M8 21h8M12 17v4"/>
            </svg>
            <span>Related Windows</span>
            <button id="btn-refresh-related" class="btn-icon" title="Refresh">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6M1 20v-6h6"/>
                    <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                </svg>
            </button>
        </div>
        <div id="related-list" class="related-list"></div>
    </section>

    <!-- Search -->
    <div id="search-container" class="search-container">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
        </svg>
        <input type="text" id="search-input" class="search-input" placeholder="Filter results...">
        <span id="search-count" class="search-count"></span>
    </div>

    <!-- Results Tabs -->
    <nav id="results-tabs" class="results-tabs">
        <button class="tab-btn active" data-tab="qa">
            Q&A <span id="qa-count" class="badge">0</span>
        </button>
        <button class="tab-btn" data-tab="correct">
            Correct <span id="correct-count" class="badge">0</span>
        </button>
        <button class="tab-btn" data-tab="apis">
            APIs <span id="apis-count" class="badge">0</span>
        </button>
        <button class="tab-btn" data-tab="logs">
            Logs <span id="logs-count" class="badge">0</span>
        </button>
    </nav>

    <!-- Tab Panels -->
    <div class="tab-panels">
        <div id="qa-panel" class="tab-panel active">
            <div id="qa-list" class="results-list">
                <div class="empty-state">No Q&A found. Try scanning the page.</div>
            </div>
        </div>

        <div id="correct-panel" class="tab-panel">
            <div class="correct-actions">
                <button id="btn-copy-all-correct" class="btn btn-outline btn-sm" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <rect x="9" y="9" width="13" height="13" rx="2"/>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                    Copy All
                </button>
            </div>
            <div id="correct-list" class="results-list">
                <div class="empty-state">No correct answers found.</div>
            </div>
        </div>

        <div id="apis-panel" class="tab-panel">
            <div id="apis-list" class="results-list">
                <div class="empty-state">No SCORM/xAPI detected.</div>
            </div>
        </div>

        <div id="logs-panel" class="tab-panel">
            <div id="logs-list" class="results-list logs-list">
                <div class="empty-state">No logs yet.</div>
            </div>
        </div>
    </div>

    <!-- SCORM Controls -->
    <section id="scorm-controls" class="scorm-controls">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            <span>SCORM Controls</span>
        </div>
        <div class="control-row">
            <button id="btn-test-api" class="btn btn-outline">Test API</button>
        </div>
        <div class="control-row">
            <select id="completion-status" class="select">
                <option value="completed">Completed</option>
                <option value="passed">Passed</option>
                <option value="failed">Failed</option>
                <option value="incomplete">Incomplete</option>
            </select>
            <input type="number" id="completion-score" class="input" value="100" min="0" max="100">
            <button id="btn-set-completion" class="btn btn-accent">Set</button>
        </div>
    </section>

    <!-- Quick Actions -->
    <section id="quick-actions" class="quick-actions">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
            </svg>
            <span>Quick Actions</span>
        </div>
        <button id="btn-auto-select" class="btn btn-success full-width">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                <path d="M22 4L12 14.01l-3-3"/>
            </svg>
            Auto-Select Answers
        </button>
        <button id="btn-element-selector" class="btn btn-outline btn-sm" title="Manual picker for custom LMS layouts">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>
            </svg>
            Manual Picker
        </button>
    </section>

    <!-- Saved Rules -->
    <section id="saved-rules" class="saved-rules" style="display: none;">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
            </svg>
            <span>Saved Rule</span>
        </div>
        <div id="rule-info" class="rule-info"></div>
        <div class="rule-actions">
            <button id="btn-apply-rule" class="btn btn-outline btn-sm">Apply Rule</button>
            <button id="btn-delete-rule" class="btn btn-outline btn-sm btn-danger">Delete</button>
        </div>
    </section>

    <!-- Rules Management -->
    <section id="rules-management" class="rules-management">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
            </svg>
            <span>Selector Rules</span>
            <span id="rules-count" class="badge rules-badge">0</span>
        </div>
        <div class="rules-buttons">
            <button id="btn-export-rules" class="btn btn-outline btn-sm">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Export
            </button>
            <button id="btn-import-rules" class="btn btn-outline btn-sm">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Import
            </button>
        </div>
        <input type="file" id="rules-file-input" accept=".json" style="display: none;">
    </section>

    <!-- Export Actions -->
    <section class="export-actions">
        <div class="section-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            <span>Export</span>
        </div>
        <div class="export-buttons">
            <button id="btn-export-json" class="btn btn-outline">JSON</button>
            <button id="btn-export-csv" class="btn btn-outline">CSV</button>
            <button id="btn-export-txt" class="btn btn-outline">TXT</button>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <span class="version">v3.9</span>
        <span class="shortcuts">Ctrl+R: Scan | Ctrl+F: Search | Ctrl+E: Export</span>
    </footer>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script src="popup.js"></script>
</body>
</html>
