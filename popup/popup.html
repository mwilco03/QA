<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=400">
    <title>LMS QA Validator</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-title">
            <svg class="logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 11l3 3L22 4"/>
                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>
            </svg>
            <h1>LMS QA Validator</h1>
        </div>
        <div id="status-indicator" class="status-indicator">
            <span class="status-dot"></span>
            <span class="status-text">Ready</span>
        </div>
    </header>

    <!-- PRIORITY 1: Quick Actions - ALWAYS VISIBLE -->
    <section id="primary-actions" class="primary-actions">
        <button id="btn-complete" class="btn btn-success btn-lg">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                <path d="M22 4L12 14.01l-3-3"/>
            </svg>
            Complete Course
        </button>
        <div class="action-row">
            <button id="btn-scan" class="btn btn-primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                </svg>
                Scan Q&A
            </button>
            <button id="btn-export-json" class="btn btn-outline">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Export
            </button>
        </div>
    </section>

    <!-- Status Panel - Shows detection status -->
    <section id="status-panel" class="status-panel">
        <div class="status-grid">
            <div class="status-item" id="status-api">
                <span class="status-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </span>
                <span class="status-label">API</span>
                <span class="status-value" id="api-status">--</span>
            </div>
            <div class="status-item" id="status-framework">
                <span class="status-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <path d="M3 9h18M9 21V9"/>
                    </svg>
                </span>
                <span class="status-label">Framework</span>
                <span class="status-value" id="framework-status">--</span>
            </div>
            <div class="status-item" id="status-questions">
                <span class="status-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </span>
                <span class="status-label">Questions</span>
                <span class="status-value" id="questions-status">--</span>
            </div>
            <div class="status-item" id="status-network">
                <span class="status-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12.55a11 11 0 0114.08 0"/>
                        <path d="M1.42 9a16 16 0 0121.16 0"/>
                        <path d="M8.53 16.11a6 6 0 016.95 0"/>
                        <line x1="12" y1="20" x2="12.01" y2="20"/>
                    </svg>
                </span>
                <span class="status-label">Network</span>
                <span class="status-value" id="network-status">--</span>
            </div>
        </div>
    </section>

    <!-- Progress -->
    <div id="progress-container" class="progress-container">
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
        </div>
        <span id="progress-text" class="progress-text">Processing...</span>
    </div>

    <!-- Search -->
    <div id="search-container" class="search-container">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
        </svg>
        <input type="text" id="search-input" class="search-input" placeholder="Filter results...">
        <span id="search-count" class="search-count"></span>
    </div>

    <!-- Results Tabs -->
    <nav id="results-tabs" class="results-tabs">
        <button class="tab-btn active" data-tab="qa">
            Q&A <span id="qa-count" class="badge">0</span>
        </button>
        <button class="tab-btn" data-tab="correct">
            Correct <span id="correct-count" class="badge">0</span>
        </button>
        <button class="tab-btn" data-tab="network">
            Network <span id="network-count" class="badge">0</span>
        </button>
        <button class="tab-btn" data-tab="apis">
            APIs <span id="apis-count" class="badge">0</span>
        </button>
    </nav>

    <!-- Tab Panels -->
    <div id="tab-panels" class="tab-panels">
        <!-- Q&A Panel (DOM extracted) -->
        <div id="qa-panel" class="tab-panel active">
            <div id="qa-list" class="results-list">
                <div class="empty-state">Click "Scan Q&A" to extract questions and answers.</div>
            </div>
        </div>

        <!-- Correct Answers Panel -->
        <div id="correct-panel" class="tab-panel">
            <div class="panel-actions">
                <button id="btn-copy-all-correct" class="btn btn-outline btn-sm" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <rect x="9" y="9" width="13" height="13" rx="2"/>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                    Copy All
                </button>
                <button id="btn-auto-select" class="btn btn-success btn-sm">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                        <path d="M22 4L12 14.01l-3-3"/>
                    </svg>
                    Auto-Select on Page
                </button>
            </div>
            <div id="correct-list" class="results-list">
                <div class="empty-state">No correct answers found yet.</div>
            </div>
        </div>

        <!-- Network Panel (TasksExtractor data) -->
        <div id="network-panel" class="tab-panel">
            <div class="panel-actions">
                <button id="btn-refresh-network" class="btn btn-outline btn-sm">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                    </svg>
                    Refresh
                </button>
            </div>
            <div id="network-list" class="results-list">
                <div class="empty-state">Monitoring network for tasks.json and xAPI statements...</div>
            </div>
        </div>

        <!-- APIs Panel -->
        <div id="apis-panel" class="tab-panel">
            <div id="apis-list" class="results-list">
                <div class="empty-state">No SCORM/xAPI APIs detected.</div>
            </div>
        </div>
    </div>

    <!-- SCORM Controls - Shows when APIs detected -->
    <section id="scorm-controls" class="scorm-controls">
        <div class="section-header collapsed" id="scorm-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            <span>SCORM/xAPI Controls</span>
            <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
            </svg>
        </div>
        <div class="scorm-body" id="scorm-body">
            <div class="control-row">
                <select id="completion-status" class="select">
                    <option value="passed">Passed</option>
                    <option value="completed">Completed</option>
                    <option value="failed">Failed</option>
                </select>
                <input type="number" id="completion-score" class="input" value="100" min="0" max="100" title="Score">
                <span class="input-suffix">%</span>
            </div>
            <div class="control-row">
                <label class="checkbox-label">
                    <input type="checkbox" id="session-time-auto" checked>
                    Auto time
                </label>
                <input type="number" id="session-time-minutes" class="input input-sm" value="15" min="1" disabled>
                <span class="input-suffix">min</span>
            </div>
            <div class="control-row actions">
                <button id="btn-test-api" class="btn btn-outline btn-sm">Test API</button>
                <button id="btn-set-completion" class="btn btn-outline btn-sm">Set Status</button>
                <button id="btn-full-completion" class="btn btn-success btn-sm">Full Complete</button>
            </div>
        </div>
    </section>

    <!-- Related Windows (collapsed by default) -->
    <section id="related-windows" class="related-windows collapsed">
        <div class="section-header" id="related-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="3" width="20" height="14" rx="2"/>
                <path d="M8 21h8M12 17v4"/>
            </svg>
            <span>Related Windows</span>
            <span id="related-count" class="badge">0</span>
            <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
            </svg>
        </div>
        <div class="related-body" id="related-body">
            <div id="related-list" class="related-list"></div>
        </div>
    </section>

    <!-- Export Options (collapsed) -->
    <section id="export-section" class="export-section collapsed">
        <div class="section-header" id="export-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            <span>Export Options</span>
            <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
            </svg>
        </div>
        <div class="export-body" id="export-body">
            <button id="btn-export-csv" class="btn btn-outline btn-sm">CSV</button>
            <button id="btn-export-txt" class="btn btn-outline btn-sm">TXT</button>
            <button id="btn-clear" class="btn btn-outline btn-sm">Clear All</button>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <span class="version">v6.0</span>
        <span id="tab-url" class="tab-url" title="Current page"></span>
    </footer>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script src="popup.js"></script>
</body>
</html>
