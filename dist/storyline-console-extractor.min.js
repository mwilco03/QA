!async function(){console.log("=== STORYLINE QUIZ EXTRACTOR v7.0 ===\n");const e={questionIndicators:["?","select","choose","which","what","identify","match","drag","complete","fill","order","arrange","indicate","determine","find","locate","click","true or false","correct answer","best answer","following","statement","example","describes","represents","demonstrates"],answerAccTypes:["checkbox","radiobutton","button","hotspot","dragitem","dropzone","droptarget","textentry","textinput","input","clickable","selectable"],correctStateIndicators:["_Review","_Selected_Review","Correct","Right","True","Yes","Selected_Correct","Drop_Correct","Drag_Correct","Match_Correct","Answer_Correct"],incorrectStateIndicators:["Incorrect","Wrong","False","No","Drop_Incorrect","Drag_Incorrect"],excludeButtonText:["continue","next","back","previous","submit","exit","close","menu","home","restart","replay","review","try again","start","begin","finish","done","ok","cancel","skip","play","pause","stop","forward","rewind"],minAnswerLength:1,minQuestionLength:10,verbose:!1};let t=performance.getEntriesByType("resource").map(e=>e.name).find(e=>e.includes("/html5/")||e.includes("/story_content/")),o=t?.match(/(.*?)\/html5\//)?.[1]||t?.match(/(.*?)\/story_content\//)?.[1];if(o||(document.querySelectorAll("script[src]").forEach(e=>{e.src.includes("/html5/")&&(o=e.src.match(/(.*?)\/html5\//)?.[1])}),document.querySelectorAll("iframe").forEach(e=>{try{e.contentDocument.querySelectorAll("script[src]").forEach(e=>{e.src.includes("/html5/")&&(o=e.src.match(/(.*?)\/html5\//)?.[1])})}catch(e){}})),!o)return console.log("Could not find course URL. Please set manually:"),console.log('  window.baseUrl = "YOUR_COURSE_URL";'),void console.log("  Then run script again.");console.log("Base URL:",o),console.log("\nFetching course data...");let s=await fetch(o+"/html5/data/js/data.js"),n=(await s.text()).match(/globalProvideData\s*\(\s*'data'\s*,\s*'(.+)'\s*\)/);if(!n)return void console.log("Could not parse data.js");let r=n[1].replace(/\\'/g,"'").replace(/\\\\"/g,'\\"').replace(/\\\\n/g,"\\n").replace(/\\\\t/g,"\\t").replace(/\\\\r/g,"\\r"),courseData=JSON.parse(r);console.log("Course data loaded");let l=[];courseData.quizzes?.forEach(e=>{e.sliderefs?.forEach(e=>{let t=e.id.split(".");l.push(t[t.length-1])})}),courseData.scenes?.forEach(e=>{e.slides?.forEach(e=>{e.id&&!l.includes(e.id)&&l.push(e.id)})}),console.log("Found",l.length,"slides to check\n");let allQA=[],c={slidesProcessed:0,slidesWithQA:0,totalQuestions:0,totalAnswers:0,totalCorrect:0,byType:{},skipped:[]};for(let t=0;t<l.length;t++){let s=l[t];try{let n=await fetch(`${o}/html5/data/js/${s}.js`);if(!n.ok)continue;let r=(await n.text()).match(/globalProvideData\s*\(\s*'slide'\s*,\s*'(.+)'\s*\)/);if(!r)continue;let i=r[1].replace(/\\'/g,"'").replace(/\\\\"/g,'\\"').replace(/\\\\n/g,"\\n").replace(/\\\\t/g,"\\t").replace(/\\\\r/g,"\\r"),u=JSON.parse(i);c.slidesProcessed++;let d=a(u,s,e,c);if(d.answers.length>0){allQA.push(d),c.slidesWithQA++,c.totalQuestions++,c.totalAnswers+=d.answers.length,c.totalCorrect+=d.answers.filter(e=>e.correct).length;let e=d.answers.filter(e=>e.correct).length;console.log(`[${t+1}/${l.length}] ${s}: ${d.answers.length} answers (${e} correct)${d.questionType?" ["+d.questionType+"]":""}`)}}catch(t){e.verbose&&console.log(`Error on ${s}:`,t.message)}}if(console.log("\n=== RESULTS ==="),console.log("Slides processed:",c.slidesProcessed),console.log("Slides with Q&A:",c.slidesWithQA),console.log("Questions found:",c.totalQuestions),console.log("Total answers:",c.totalAnswers),console.log("Correct answers:",c.totalCorrect),Object.keys(c.byType).length>0&&(console.log("\nAnswer types found:"),Object.entries(c.byType).sort((e,t)=>t[1]-e[1]).forEach(([e,t])=>{console.log(`  ${e}: ${t}`)})),c.skipped.length>0){console.log("\nFiltered out:");let e={};c.skipped.forEach(t=>{let o=`${t.reason}`;e[o]=(e[o]||0)+1}),Object.entries(e).forEach(([e,t])=>{console.log(`  ${e}: ${t}`)})}function a(e,t,o,s){let n={slideId:t,question:"",questionType:null,answers:[],rawElements:[]};return function e(t,r=""){if(!t||"object"!=typeof t)return;let l=function(e){return e.textLib?.[0]?.vartext?.blocks?e.textLib[0].vartext.blocks.flatMap(e=>e.spans?.map(e=>e.text)||[]).join("").replace(/\\n/g," ").replace(/\s+/g," ").trim():e.rawText?e.rawText.replace(/\\n/g," ").replace(/\s+/g," ").trim():"string"==typeof e.text?e.text.replace(/\\n/g," ").replace(/\s+/g," ").trim():"string"==typeof e.title?e.title.trim():"string"==typeof e.label?e.label.trim():"string"==typeof e.accText?e.accText.trim():""}(t),c=t.accType;if(function(e){return!!e&&o.answerAccTypes.some(t=>e.toLowerCase()===t.toLowerCase())}(c)&&l&&l.length>=o.minAnswerLength){let e=l.toLowerCase().trim();if("button"===c&&o.excludeButtonText.some(t=>e===t||e.includes(t)))return o.verbose&&console.log(`  Skipped nav button: "${l}"`),void s.skipped.push({text:l,reason:"navigation button",accType:c});if(n.answers.some(e=>e.text===l))return o.verbose&&console.log(`  Skipped duplicate: "${l}"`),void s.skipped.push({text:l,reason:"duplicate",accType:c});let r=function(e){if(!e.states||!Array.isArray(e.states))return!1;let t=e.states.some(e=>o.correctStateIndicators.some(t=>e.name?.toLowerCase().includes(t.toLowerCase()))),s=e.states.every(e=>o.incorrectStateIndicators.some(t=>e.name?.toLowerCase().includes(t.toLowerCase())));return t&&!s}(t);n.answers.push({text:l,correct:r,accType:c,states:t.states?.map(e=>e.name)||[]}),s.byType[c]=(s.byType[c]||0)+1,n.questionType||("checkbox"===c?n.questionType="multiple-select":"radiobutton"===c?n.questionType="multiple-choice":"dragitem"===c||"dropzone"===c||"droptarget"===c?n.questionType="drag-drop":"hotspot"===c?n.questionType="hotspot":"textentry"===c||"textinput"===c?n.questionType="fill-in":"button"===c&&(n.questionType="button-choice")),o.verbose&&console.log(`  Found answer: "${l.substring(0,40)}..." [${c}] correct=${r}`)}"text"!==c&&c||function(e){if(!e||e.length<o.minQuestionLength)return!1;let t=e.toLowerCase();return o.questionIndicators.some(e=>t.includes(e.toLowerCase()))}(l)&&(n.answers.some(e=>e.text===l)?o.verbose&&console.log(`  Skipped as question (is answer): "${l.substring(0,50)}..."`):(!n.question||l.length>n.question.length)&&(n.question=l,o.verbose&&console.log(`  Found question: "${l.substring(0,50)}..."`)));for(let o in t)Array.isArray(t[o])?t[o].forEach((t,s)=>e(t,`${r}.${o}[${s}]`)):"object"==typeof t[o]&&e(t[o],`${r}.${o}`)}(e),n}console.log("\n=== QUESTIONS & ANSWERS ===\n"),allQA.forEach((e,t)=>{console.log(`--- Question ${t+1} [${e.slideId}]${e.questionType?" ("+e.questionType+")":""} ---`),e.question&&console.log("Q:",e.question),e.answers.forEach((e,t)=>{e.correct;let o=e.accType?` (${e.accType})`:"";console.log(`  ${t+1}. ${e.correct?"[X]":"[ ]"} ${e.text}${o}`)}),console.log("")}),window.allQA=allQA,window.courseData=courseData,window.extractorStats=c,window.extractorConfig=e,console.log("=== SAVED ==="),console.log("window.allQA - all questions/answers"),console.log("window.courseData - full course data"),console.log("window.extractorStats - detection statistics"),console.log("window.extractorConfig - detection configuration"),console.log('\nRun exportQA("json") to download results'),console.log('Run exportQA("txt") for readable format'),window.exportQA=function(e="json"){let t=window.allQA,o="",s="answer_key",n="application/json";"json"===e?(o=JSON.stringify(t,null,2),s="answer_key.json",n="application/json"):(o="=== ANSWER KEY ===\n\n",t.forEach((e,t)=>{o+=`--- Question ${t+1} [${e.slideId}]${e.questionType?" ("+e.questionType+")":""} ---\n`,e.question&&(o+=`Q: ${e.question}\n`),e.answers.forEach((e,t)=>{o+=`${t+1}. ${e.correct?"[X] CORRECT":"[ ]"} ${e.text}\n`}),o+="\n"}),o+="\n=== CORRECT ANSWERS ONLY ===\n\n",t.forEach((e,t)=>{let s=e.answers.filter(e=>e.correct);s.length&&(o+=`Q${t+1}: ${s.map(e=>e.text).join(" | ")}\n`)}),s="answer_key.txt",n="text/plain");let r=new Blob([o],{type:n}),l=document.createElement("a");l.href=URL.createObjectURL(r),l.download=s,l.click(),console.log("Downloaded",s)}}();